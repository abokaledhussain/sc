<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ“˜ ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ - Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„Ù‰</title>

<style>
:root {
  --primary:#1f5fa6;
  --primary-700:#174b83;
  --accent:#0ea5e9;
  --bg:#f2f4f8;
  --card:#fff;
  --muted:#6b7280;
  --ok:#16a34a;
  --warn:#ef4444;
  --border:#e5e7eb;
  --delay:#f59e0b;
}

* {box-sizing:border-box; margin:0; padding:0;}
html, body {overflow-x:hidden; font-family: system-ui, -apple-system, sans-serif;}
body {
  background:var(--bg);
  color:#111;
  padding:20px;
}

.container {max-width:1100px; margin:0 auto;}

/* Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø°ÙƒÙŠ */
#pwa-home-button {
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 10000;
  display: none;
}

#pwa-home-button.visible {
  display: block;
}

.home-btn {
  background: #007AFF;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 20px;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  font-weight: bold;
}

/* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
header {
  background:linear-gradient(135deg, var(--primary), var(--primary-700));
  color:#fff;
  border-radius:16px;
  padding:16px;
  margin-bottom:20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

header h1 {margin:0; font-size:20px;}
header p {margin:6px 0 0; color:#e2e8f0; font-size:12px;}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
.card {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}

.btn {
  border:1px solid var(--border);
  border-radius:10px;
  background:#fff;
  padding:8px 12px;
  cursor:pointer;
  margin:2px;
}

input, select, textarea {
  width:100%;
  padding:8px;
  border:1px solid var(--border);
  border-radius:8px;
  margin-bottom:8px;
}

.hidden {display:none!important;}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ */
table {
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}

th, td {
  padding:8px;
  border-bottom:1px solid var(--border);
  text-align:right;
}

th {
  background:#eff6ff;
}
</style>
</head>
<body>
<!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø°ÙƒÙŠ -->
<div id="pwa-home-button">
  <button class="home-btn" onclick="goToHomePage()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>

<div class="container">
  <header>
    <div>
      <h1>ğŸ“˜ ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ - Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„Ù‰</h1>
      <p>Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„: ÙƒØ´ÙˆÙØ§Øª â€“ Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§ØªØ³Ø§Ø¨ â€“ Ø¥Ø­ØµØ§Ø¡Ø§Øª</p>
    </div>
    <button class="btn" onclick="openSettings()">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </header>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
  <div class="card">
    <div style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px;">
      <button class="btn" onclick="addStudent()">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
      <input type="text" id="searchBox" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." style="flex:1; min-width:200px;">
      <button class="btn" onclick="printTable()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>
  </div>

  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
  <div class="card" id="addFormCard">
    <h3 style="margin-bottom:12px;">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
      <div><input type="text" id="f_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨"></div>
      <div><input type="tel" id="f_phone" placeholder="Ø§Ù„Ø¬ÙˆØ§Ù„"></div>
      <div><input type="text" id="f_id" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©"></div>
      <div><input type="text" id="f_grade" placeholder="Ø§Ù„ØµÙ"></div>
      <div><input type="text" id="f_class" placeholder="Ø§Ù„ÙØµÙ„"></div>
    </div>
    <button class="btn" onclick="saveStudent()" style="background:var(--ok);color:#fff;margin-top:12px;">Ø­ÙØ¸</button>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ -->
  <div class="card">
    <table id="studentsTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
          <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
          <th>Ø§Ù„ØµÙ</th>
          <th>Ø§Ù„ÙØµÙ„</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
      </tbody>
    </table>
  </div>
</div>

<script>
// ===== Ø§Ù„ØªØ®Ø²ÙŠÙ† =====
const LS_KEY = 'students_db';

// ===== Ø§Ù„Ø­Ø§Ù„Ø© =====
let students = [];
let editingId = null;

// ===== DOM =====
const $ = (id) => document.getElementById(id);

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ† =====
function saveToStorage() {
    localStorage.setItem(LS_KEY, JSON.stringify(students));
    renderTable();
}

function loadFromStorage() {
    try {
        const data = localStorage.getItem(LS_KEY);
        students = data ? JSON.parse(data) : [];
    } catch (e) {
        students = [];
    }
    renderTable();
}

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ =====
function addStudent() {
    $('addFormCard').classList.remove('hidden');
}

function saveStudent() {
    const student = {
        id: editingId || Date.now().toString(),
        name: $('f_name').value.trim(),
        phone: $('f_phone').value.trim(),
        idNumber: $('f_id').value.trim(),
        grade: $('f_grade').value.trim(),
        class: $('f_class').value.trim()
    };

    if (!student.name) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
        return;
    }

    if (editingId) {
        // ØªØ­Ø¯ÙŠØ« Ø·Ø§Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯
        const index = students.findIndex(s => s.id === editingId);
        if (index > -1) {
            students[index] = student;
        }
    } else {
        // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        students.unshift(student);
    }

    clearForm();
    saveToStorage();
}

function editStudent(id) {
    const student = students.find(s => s.id === id);
    if (student) {
        $('f_name').value = student.name || '';
        $('f_phone').value = student.phone || '';
        $('f_id').value = student.idNumber || '';
        $('f_grade').value = student.grade || '';
        $('f_class').value = student.class || '';
        editingId = id;
        $('addFormCard').classList.remove('hidden');
        $('addFormCard').scrollIntoView({behavior: 'smooth'});
    }
}

function deleteStudent(id) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) {
        students = students.filter(s => s.id !== id);
        saveToStorage();
    }
}

function clearForm() {
    $('f_name').value = '';
    $('f_phone').value = '';
    $('f_id').value = '';
    $('f_grade').value = '';
    $('f_class').value = '';
    editingId = null;
    $('addFormCard').classList.add('hidden');
}

// ===== Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ =====
function renderTable() {
    const tbody = $('tbody');
    const searchText = ($('searchBox')?.value || '').toLowerCase();
    
    const filteredStudents = students.filter(student => 
        !searchText || 
        (student.name || '').toLowerCase().includes(searchText) ||
        (student.phone || '').includes(searchText) ||
        (student.idNumber || '').includes(searchText)
    );

    tbody.innerHTML = filteredStudents.map(student => `
        <tr>
            <td>${escapeHtml(student.name || '')}</td>
            <td>${escapeHtml(student.phone || '')}</td>
            <td>${escapeHtml(student.idNumber || '')}</td>
            <td>${escapeHtml(student.grade || '')}</td>
            <td>${escapeHtml(student.class || '')}</td>
            <td>
                <button class="btn" onclick="editStudent('${student.id}')" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                <button class="btn" onclick="deleteStudent('${student.id}')" title="Ø­Ø°Ù" style="background:#fee2e2;color:#dc2626;">ğŸ—‘ï¸</button>
            </td>
        </tr>
    `).join('');

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
    const counter = document.getElementById('counter');
    if (!counter) {
        const counterEl = document.createElement('div');
        counterEl.id = 'counter';
        counterEl.style.marginTop = '12px';
        counterEl.style.padding = '8px';
        counterEl.style.background = '#f8fafc';
        counterEl.style.borderRadius = '8px';
        counterEl.style.textAlign = 'center';
        $('studentsTable').parentNode.appendChild(counterEl);
    }
    document.getElementById('counter').textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: ${filteredStudents.length} Ù…Ù† Ø£ØµÙ„ ${students.length}`;
}

function escapeHtml(text) {
    return String(text || '').replace(/[&<>"']/g, 
        char => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[char]));
}

// ===== Ø§Ù„Ø¨Ø­Ø« =====
function setupSearch() {
    const searchBox = $('searchBox');
    if (searchBox) {
        searchBox.addEventListener('input', renderTable);
    }
}

// ===== Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© =====
function printTable() {
    const studentsToPrint = students.filter(student => 
        !($('searchBox')?.value || '') || 
        (student.name || '').toLowerCase().includes(($('searchBox').value || '').toLowerCase())
    );

    if (studentsToPrint.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
        return;
    }

    const html = `
    <html dir="rtl">
    <head>
        <title>ÙƒØ´Ù Ø§Ù„Ø·Ù„Ø§Ø¨</title>
        <style>
            body { font-family: system-ui; padding: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #000; padding: 8px; text-align: right; }
            th { background: #f0f0f0; }
        </style>
    </head>
    <body>
        <h2 style="text-align:center;">ÙƒØ´Ù Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                    <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                    <th>Ø§Ù„ØµÙ</th>
                    <th>Ø§Ù„ÙØµÙ„</th>
                </tr>
            </thead>
            <tbody>
                ${studentsToPrint.map(student => `
                    <tr>
                        <td>${student.name || ''}</td>
                        <td>${student.phone || ''}</td>
                        <td>${student.idNumber || ''}</td>
                        <td>${student.grade || ''}</td>
                        <td>${student.class || ''}</td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    </body>
    </html>`;

    const printWindow = window.open('', '_blank');
    printWindow.document.write(html);
    printWindow.document.close();
    printWindow.print();
}

// ===== Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø°ÙƒÙŠ =====
function isRunningAsPWA() {
    return window.navigator.standalone || 
           window.matchMedia('(display-mode: standalone)').matches;
}

function checkAndShowHomeButton() {
    const homeButton = $('pwa-home-button');
    if (!homeButton) return;
    
    if (isRunningAsPWA()) {
        const isHomePage = window.location.pathname === '/' || 
                          window.location.pathname.endsWith('index.html') ||
                          (window.location.search === '' && window.location.hash === '');
        
        if (isHomePage) {
            homeButton.classList.remove('visible');
        } else {
            homeButton.classList.add('visible');
        }
    } else {
        homeButton.classList.remove('visible');
    }
}

function goToHomePage() {
    window.location.href = window.location.origin + window.location.pathname;
}

// ===== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª =====
function openSettings() {
    alert('Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø©');
}

// ===== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© =====
function init() {
    loadFromStorage();
    setupSearch();
    checkAndShowHomeButton();
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØµÙØ­Ø©
    setInterval(checkAndShowHomeButton, 1000);
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
