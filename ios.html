<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ“˜ ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ - Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„Ù‰ (Pro)</title>

<!-- âœ… Ø®Ø·ÙˆØ· -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<!-- âœ… Ù…ÙƒØªØ¨Ø© Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root {
  --primary:#1f5fa6;
  --primary-700:#174b83;
  --accent:#0ea5e9;
  --bg:#f2f4f8;
  --card:#fff;
  --muted:#6b7280;
  --ok:#16a34a;
  --warn:#ef4444;
  --border:#e5e7eb;
  --delay:#f59e0b;
}

* {box-sizing:border-box}
html, body {overflow-x:hidden}
body {
  margin:0;
  background:var(--bg);
  font-family:Cairo, sans-serif;
  color:#111;
}

.container {max-width:1100px; margin:24px auto; padding:0 16px}

/* âœ… Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
#pwa-home-button {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 10000;
  display: none;
  transition: all 0.3s ease;
}

#pwa-home-button.visible {
  display: block;
}

.home-btn {
  background: #007AFF;
  color: white;
  border: none;
  padding: 12px 18px;
  border-radius: 25px;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  font-weight: bold;
  font-family: Cairo, sans-serif;
  transition: all 0.3s ease;
}

.home-btn:hover {
  background: #0056CC;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
}

/* âœ… Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
header {
  position:relative;
  background:linear-gradient(135deg, var(--primary), var(--primary-700));
  color:#fff;
  border-radius:16px;
  padding:16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

header h1 {margin:0; font-size:22px; line-height:1.4}
header p {margin:6px 0 0; color:#e2e8f0; font-size:13px; line-height:1.6}
#schoolLogo {max-height:64px; max-width:120px; object-fit:contain}
.logo-wrap {display:flex; align-items:center; gap:8px}

/* âœ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
.card {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-top:12px;
}

.toolbar, .filters {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
}

.btn {
  border:1px solid var(--border);
  border-radius:10px;
  background:#fff;
  padding:8px 12px;
  cursor:pointer;
}

.btn:disabled {opacity:.6; cursor:not-allowed}

input, select, textarea {
  width:100%;
  padding:9px;
  border:1px solid var(--border);
  border-radius:10px;
}

textarea {min-height:110px}
.small {color:var(--muted); font-size:12px}
.grid-2 {display:grid; grid-template-columns:1fr 1fr; gap:12px}
.grid-fit {display:grid; grid-template-columns:repeat(auto-fit, minmax(180px,1fr)); gap:8px}

/* âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ */
.table-card {overflow:auto; border-radius:14px}
table {width:100%; border-collapse:separate; border-spacing:0}
thead th {
  background:#eff6ff;
  padding:10px;
  border-bottom:1px solid var(--border);
  text-align:right;
  position:sticky;
  top:0;
}
tbody td {padding:10px; border-bottom:1px solid var(--border)}

.hidden {display:none}
.nowrap {white-space:nowrap}
.tag {border-radius:999px; padding:2px 8px; font-size:12px}
.badge-warn {
  display:inline-flex;
  align-items:center;
  gap:6px;
  background:#fff7ed;
  color:#9a3412;
  border:1px solid #fed7aa;
  border-radius:999px;
  padding:2px 8px;
  font-size:12px;
}

/* âœ… Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Accordion + Panel) */
.settings-panel {
  position:absolute;
  top:0;
  right:-420px;
  width:420px;
  min-height:100vh;
  background:#fff;
  box-shadow:-3px 0 14px rgba(0,0,0,.12);
  border-left:1px solid var(--border);
  transition:.3s;
  z-index:1000;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.settings-panel.open {right:0}

.settings-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:4px;
}
.close-settings {
  cursor:pointer;
  background:none;
  border:none;
  font-size:20px;
  color:#666;
}

/* âœ… Accordion */
.accordion {border:1px solid var(--border); border-radius:12px; overflow:hidden; background:#fff}
.acc-head {
  padding:12px 14px;
  background:#f8fafc;
  cursor:pointer;
  font-weight:700;
  display:flex;
  align-items:center;
  gap:8px;
}
.acc-body {padding:12px 14px; display:none}
.accordion.open .acc-body {display:block}
.scrollable-acc-content {
  overflow-y:auto;
  max-height:60vh;
  padding-inline-end:10px;
}

/* âœ… ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© */
.header-plain {
  width:100%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:8px;
}

.header-plain .col {line-height:1.4; font-weight:700}
.header-plain .col.center {display:flex; justify-content:center}
.header-date {text-align:center; font-size:13px; margin-bottom:8px}
/* âœ… ØªÙƒÙ…Ù„Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª */
#btnPrintStats { display:none !important; }

/* Ù…Ø¹Ø§ÙŠÙ†Ø§Øª */
.logo-preview{display:flex;align-items:center;gap:10px}
.logo-preview img{max-height:56px;max-width:140px;border:1px dashed var(--border);padding:6px;border-radius:8px;background:#fafafa}

/* Ù†ÙˆØ§ÙØ° Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø§Ù…Ø© */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;justify-content:center;align-items:center}
.modal-content{background:#fff;width:min(980px,94vw);max-height:86vh;overflow:auto;border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
.close{float:left;cursor:pointer;font-size:26px;color:#555}

/* Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© ØªÙØ­Ù‚Ù† Ø¹Ø¨Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ù† JS */
@page { size:A4; margin:8mm; }
/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ØµØºÙŠØ±Ø© Ø¨Ø¯ÙˆÙ† Ø®Ù„ÙÙŠØ© */
.icon-btn {
  background: transparent;
  border: none;
  padding: 4px;
  margin: 0 2px;
  font-size: 18px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: inherit;
}

.icon-btn:hover {
  background: rgba(0,0,0,0.04);
  border-radius: 6px;
}

.icon-btn:focus {
  outline: 2px solid rgba(0,0,0,0.12);
  outline-offset: 2px;
  border-radius: 6px;
}

.status-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  display: inline-block;
  vertical-align: middle;
}

.icon-small { font-size: 14px; padding: 2px; }

</style>
</head>
<body>
<!-- âœ… Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="pwa-home-button" class="hidden">
  <button class="home-btn" onclick="goToHomePage()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>

<div class="container">
  <header>
    <div>
      <h1>ğŸ“˜ ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ - Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„Ù‰</h1>
      <p>Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„: ÙƒØ´ÙˆÙØ§Øª â€“ Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§ØªØ³Ø§Ø¨ â€“ Ø¥Ø­ØµØ§Ø¡Ø§Øª. ØªØ·ÙˆÙŠØ± ÙˆØ¯Ø¹Ù… / Ø­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±ÙŠØ§Ù†ÙŠ</p>
    </div>
    <div class="logo-wrap">
      <img id="schoolLogo" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" class="hidden">
      <button class="btn" onclick="openSettings()">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>
  </header>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
  <div class="card">
    <div class="toolbar">
      <label class="btn" style="background:var(--primary);color:#fff;border-color:transparent">
        ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel
        <input id="excelInput" type="file" accept=".xlsx,.xls" hidden>
      </label>

      <label class="btn">
        â­³ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© (JSON)
        <input id="restoreInput" type="file" accept=".json" hidden>
      </label>

      <button class="btn" id="exportBtn">ğŸ’¾ ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
      <button class="btn" id="clearBtn">ğŸ§¹ ØªÙØ±ÙŠØº Ø§Ù„ØªØ®Ø²ÙŠÙ†</button>

      <div style="flex:1;min-width:240px">
        <input id="searchBox" type="text" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©...">
      </div>

      <button class="btn" id="printBtn" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØµÙÙ‘Ø§Ø©">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
      <button class="btn" id="exportExcelBtn" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØµÙÙ‘Ø§Ø© Ø¥Ù„Ù‰ Excel">ğŸ“¤ ØªØµØ¯ÙŠØ± Excel</button>
      <button class="btn" id="exportAllPdfBtn" title="Ø§Ø³ØªØ®Ø±Ø§Ø¬ PDF Ù„ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨">ğŸ“„ PDF Ø§Ù„ÙƒÙ„</button>
    </div>

    <!-- ÙÙ„Ø§ØªØ± -->
    <div class="filters">
      <div>
        <label class="small">Ø§Ù„ØµÙ</label>
        <select id="gradeFilter"><option value="">ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option></select>
      </div>
      <div>
        <label class="small">Ø§Ù„ÙØµÙ„</label>
        <select id="classFilter" disabled><option value="">ÙƒÙ„ Ø§Ù„ÙØµÙˆÙ„</option></select>
      </div>
      <button class="btn" id="resetFiltersBtn">â™»ï¸ Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
      <span class="small">ØªÙ†Ø³ÙŠÙ‚ Excel: Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ØŒ Ø§Ù„Ø¬ÙˆØ§Ù„ØŒ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ Ø§Ù„ØµÙØŒ Ø§Ù„ÙØµÙ„</span>

      <button class="btn" id="toggleAddFormBtn" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ©">â• Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„</button>
      <button class="btn" style="background:#f59e0b;color:#fff" onclick="printFilteredGradeReport()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© ÙƒØ´Ù Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</button>
    </div>
  </div>

  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ©/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
  <div class="card" id="addFormCard">
    <h3 id="formTitle" style="margin-top:0">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
    <div class="grid-2">
      <div><label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label><input id="f_name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ"></div>
      <div>
        <label>Ø§Ù„Ø¬ÙˆØ§Ù„</label>
        <input id="f_phone" type="tel" placeholder="05xxxxxxxx">
        <div class="small">ÙŠÙØ­ÙˆÙ‘Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„ØµÙŠØºØ© ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (+966)</div>
      </div>
      <div><label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label><input id="f_id" type="text" placeholder="10 Ø£Ø±Ù‚Ø§Ù…"></div>
      <div class="grid-fit">
        <div><label>Ø§Ù„ØµÙ</label><input id="f_grade" type="text" placeholder="Ø£ÙˆÙ„ / Ø«Ø§Ù†ÙŠ / Ø«Ø§Ù„Ø«..."></div>
        <div><label>Ø§Ù„ÙØµÙ„</label><input id="f_class" type="text" placeholder="Ø£ / Ø¨ / 1 / 2"></div>
      </div>
    </div>
    <div class="toolbar" style="gap:10px;margin-top:12px">
      <button class="btn" style="background:var(--ok);color:#fff;border-color:transparent" id="saveBtn">Ø­ÙØ¸</button>
      <button class="btn hidden" id="cancelEditBtn">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
    </div>
  </div>

  <!-- Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§ØªØ³Ø§Ø¨ -->
  <div class="card" id="waSection">
    <h3 style="margin-top:0">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© ÙˆØ§ØªØ³Ø§Ø¨</h3>
    <div class="grid-2">
      <div>
        <label>ğŸ“© Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
        <select id="templateSelect">
          <option value="delay">1) ØªØ£Ø®Ø± Ø§Ø¨Ù†ÙƒÙ… Ø§Ù„ÙŠÙˆÙ…</option>
          <option value="absent">2) ØºÙŠØ§Ø¨ Ø§Ø¨Ù†ÙƒÙ… Ø§Ù„ÙŠÙˆÙ…</option>
          <option value="custom">3) Ø±Ø³Ø§Ù„Ø© Ù…Ø®ØµØµØ©</option>
        </select>
        <div class="small">Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª: {name}ØŒ {day}ØŒ {date}ØŒ {hijri}ØŒ {fullDate}ØŒ {time}</div>
      </div>

      <div style="display:flex;align-items:flex-end">
        <label class="btn" style="display:inline-flex;align-items:center;gap:8px">âœ… ØªØ­Ø¯ÙŠØ¯ ÙƒÙ„ Ø§Ù„Ø¸Ø§Ù‡Ø±
          <input type="checkbox" id="selectAllFiltered" hidden>
        </label>
      </div>

      <div>
        <label>Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
        <textarea id="bulkMsg" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡"></textarea>
      </div>

      <div>
        <label>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</label>
        <div class="grid-fit">
          <button class="btn" style="background:var(--primary);color:#fff;border-color:transparent" id="bulkWhatsAppBtn">âœ¨ Ø¥Ø¹Ø¯Ø§Ø¯ Ø±ÙˆØ§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨</button>
          <button class="btn" style="background:var(--ok);color:#fff;border-color:transparent" id="startAutoBtn">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
          <button class="btn" style="background:var(--warn);color:#fff;border-color:transparent" id="stopAutoBtn" disabled>â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
          <button class="btn" style="background:var(--warn);color:#fff;border-color:transparent" id="bulkDeleteBtn">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†</button>
        </div>
        <div id="autoStatus" class="small" style="display:none;margin-top:6px">Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ØºÙŠØ± Ù†Ø´Ø·</div>
        <div class="small">Ù‚Ø¯ ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©. ÙŠÙÙØ¶Ù‘Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨).</div>
      </div>
    </div>
    <div style="height:1px;background:var(--border);margin:10px 0"></div>
    <div id="bulkLinks" class="grid-fit hidden"></div>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ -->
  <div class="card" style="padding:0">
    <div class="table-card">
      <table id="studentsTable">
        <thead>
          <tr>
            <th class="nowrap">ØªØ­Ø¯ÙŠØ¯</th>
            <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
            <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
            <th>Ø§Ù„ØµÙ</th>
            <th>Ø§Ù„ÙØµÙ„</th>
            <th class="nowrap">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
  <div class="card">
    <div style="display:flex;flex-wrap:wrap;gap:8px">
      <span class="tag" style="background:#eef2ff;color:#1e3a8a">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b id="countTotal">0</b></span>
      <span class="tag" style="background:#eef2ff;color:#1e3a8a">Ù…Ø­Ø¯Ø¯: <b id="countSelected">0</b></span>
      <span class="tag" style="background:#eef2ff;color:#1e3a8a">Ù…Ø·Ø§Ø¨Ù‚Ø©: <b id="countFiltered">0</b></span>
    </div>
  </div>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
<div id="settingsPanel" class="settings-panel">
  <div class="settings-header">
    <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
    <button class="close-settings" onclick="closeSettings()">âœ–</button>
  </div>

  <!-- ğŸ–¼ Ø§Ù„Ø´Ø¹Ø§Ø± -->
  <div class="accordion" id="acc-logo">
    <div class="acc-head" onclick="toggleAcc('acc-logo')">ğŸ–¼ï¸ Ø§Ù„Ø´Ø¹Ø§Ø±</div>
    <div class="acc-body">
      <div class="logo-preview">
        <img id="logoPreview" class="hidden" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±">
        <span id="logoNone" class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø¹Ø§Ø± Ø­Ø§Ù„ÙŠÙ‹Ø§</span>
      </div>
      <div class="grid-fit" style="margin-top:8px">
        <label class="btn">â¬†ï¸ Ø§Ø®ØªØ± Ø´Ø¹Ø§Ø±
          <input id="logoInput" type="file" accept="image/*" hidden>
        </label>
        <button class="btn" id="logoRemoveBtn">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø´Ø¹Ø§Ø±</button>
      </div>
      <div class="small">Ø§Ù„Ø´Ø¹Ø§Ø± Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©/Ø§Ù„ØªØµØ¯ÙŠØ±.</div>
    </div>
  </div>

  <!-- ğŸ“„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© -->
  <div class="accordion" id="acc-header">
    <div class="acc-head" onclick="toggleAcc('acc-header')">ğŸ“„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ±ÙˆÙŠØ³Ø©</div>
    <div class="acc-body">
      <div class="grid-2">
        <div><label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label><input id="hdr_country" type="text" value="Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"></div>
        <div><label>Ø§Ù„ÙˆØ²Ø§Ø±Ø©</label><input id="hdr_ministry" type="text" value="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…"></div>
      </div>
      <div class="grid-2">
        <div><label>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</label><input id="hdr_directorate" type="text" value="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ù…Ø­Ø§ÙØ¸Ø© Ø¬Ø¯Ø©"></div>
        <div><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label><input id="hdr_school" type="text" value="Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ù†ÙŠÙ†"></div>
      </div>
      <div class="grid-fit" style="margin-top:6px">
        <button class="btn" id="saveHeaderBtn" style="background:var(--ok);color:#fff">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ±ÙˆÙŠØ³Ø©</button>
        <button class="btn" id="resetHeaderBtn">ğŸ” Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
      </div>
      <div class="small">Ø³ØªÙØ³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆExcel ÙˆPDFØŒ ÙˆÙŠÙØ¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù‡Ø¬Ø±ÙŠ + Ù…ÙŠÙ„Ø§Ø¯ÙŠ) ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
    </div>
  </div>

  <!-- â° Ø¯ÙˆØ§Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© -->
  <div class="accordion" id="acc-start">
    <div class="acc-head" onclick="toggleAcc('acc-start')">â° Ø¯ÙˆØ§Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
    <div class="acc-body">
      <label>ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù… (24h)</label>
      <div class="grid-fit">
        <input id="schoolStart" type="time" value="07:15">
        <button class="btn" id="saveStartBtn">ğŸ’¾ Ø­ÙØ¸</button>
      </div>
      <div class="small">ÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ø­Ø³Ø§Ø¨ Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„ØªØ£Ø®Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
    </div>
  </div>

  <!-- ğŸ§© Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© -->
  <div class="accordion" id="acc-ui">
    <div class="acc-head" onclick="toggleAcc('acc-ui')">ğŸ§© Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</div>
    <div class="acc-body">
      <label class="small">Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡</label>
      <label><input type="checkbox" id="opt_collapseAddForm" checked> Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø­ØªÙ‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ â•</label><br>
      <label><input type="checkbox" id="opt_hideWASection"> Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§ØªØ³Ø§Ø¨</label><br>
      <label><input type="checkbox" id="opt_showRowSummary" checked> Ù…Ù„Ø®Øµ Ø§Ù„ØºÙŠØ§Ø¨/Ø§Ù„ØªØ£Ø®Ø± ØªØ­Øª Ø§Ù„Ø§Ø³Ù…</label><br>
      <label><input type="checkbox" id="opt_showLastMsg" checked> Ø¥Ø¸Ù‡Ø§Ø± Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©</label><br>
      <label><input type="checkbox" id="opt_showWarnings" checked> Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ù†Ø°Ø§Ø±Ø§Øª</label><br>
      <label><input type="checkbox" id="opt_showRowWA" checked> Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø¨ÙƒÙ„ ØµÙ</label><br>
      <button class="btn" id="saveProBtn" style="margin-top:6px">ğŸ’¾ Ø­ÙØ¸</button>
    </div>
  </div>

  <!-- ğŸš¨ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¥Ù†Ø°Ø§Ø± -->
  <div class="accordion" id="acc-thr">
    <div class="acc-head" onclick="toggleAcc('acc-thr')">ğŸš¨ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¥Ù†Ø°Ø§Ø±</div>
    <div class="acc-body">
      <div class="grid-2">
        <div><label>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ£Ø®Ø± Ù„Ø¸Ù‡ÙˆØ± "Ø¥Ù†Ø°Ø§Ø±"</label><input id="thr_delay_alert" type="number" value="3"></div>
        <div><label>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ£Ø®Ø± Ù„Ø¸Ù‡ÙˆØ± "ØªØ­Ø°ÙŠØ± ÙƒØ¨ÙŠØ±"</label><input id="thr_delay_warn" type="number" value="5"></div>
      </div>
      <div class="grid-2">
        <div><label>Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ø¸Ù‡ÙˆØ± "Ø¥Ù†Ø°Ø§Ø±"</label><input id="thr_absent_alert" type="number" value="3"></div>
        <div><label>Ø¹Ø¯Ø¯ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ø¸Ù‡ÙˆØ± "ØªØ­Ø°ÙŠØ± ÙƒØ¨ÙŠØ±"</label><input id="thr_absent_warn" type="number" value="5"></div>
      </div>
      <button class="btn" id="saveThrBtn" style="margin-top:6px">ğŸ’¾ Ø­ÙØ¸</button>
    </div>
  </div>

  <!-- ğŸ’¬ Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ + Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
  <div class="accordion" id="acc-wa">
    <div class="acc-head" onclick="toggleAcc('acc-wa')">ğŸ’¬ Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ + Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</div>
    <div class="acc-body">
      <div class="scrollable-acc-content">
        <label>Ù‚Ø§Ù„Ø¨ ØªØ£Ø®Ø± Ø§Ù„Ø·Ø§Ù„Ø¨</label><textarea id="tplDelay"></textarea>
        <label>Ù‚Ø§Ù„Ø¨ ØºÙŠØ§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨</label><textarea id="tplAbsent"></textarea>
        <label>Ù‚Ø§Ù„Ø¨ Ø±Ø³Ø§Ù„Ø© Ù…Ø®ØµØµØ©</label><textarea id="tplCustom"></textarea>

        <div class="grid-fit" style="margin-top:6px">
          <button class="btn" id="saveTplBtn" style="background:var(--primary);color:#fff">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</button>
          <button class="btn" id="resetTplBtn">ğŸ” Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
        </div>

        <hr>
        <label>ğŸ“„ Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©</label><br>
        <label><input type="checkbox" id="col_name" checked> Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label><br>
        <label><input type="checkbox" id="col_phone" checked> Ø§Ù„Ø¬ÙˆØ§Ù„</label><br>
        <label><input type="checkbox" id="col_id" checked> Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label><br>
        <label><input type="checkbox" id="col_grade" checked> Ø§Ù„ØµÙ</label><br>
        <label><input type="checkbox" id="col_class" checked> Ø§Ù„ÙØµÙ„</label><br>

        <div class="grid-fit" style="margin-top:6px">
          <button class="btn" id="savePEBtn" style="background:var(--ok);color:#fff">ğŸ’¾ Ø­ÙØ¸</button>
          <button class="btn" id="resetPEBtn">ğŸ” Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ–¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø·Ø¨Ø§Ø¹Ø© ÙƒØ´Ù Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© -->
  <div class="accordion" id="acc-print">
    <div class="acc-head" onclick="toggleAcc('acc-print')">ğŸ–¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø·Ø¨Ø§Ø¹Ø© ÙƒØ´Ù Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</div>
    <div class="acc-body">
      <div class="scrollable-acc-content">
        <label>ğŸ“ Ø§Ø³Ù… Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø³Ù„ÙˆÙƒ</label>
        <input type="text" id="col_behavior" value="Ø§Ù„Ø³Ù„ÙˆÙƒ">

        <label>ğŸ“š Ø§Ø³Ù… Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙƒØªØ§Ø¨</label>
        <input type="text" id="col_book" value="Ø§Ù„ÙƒØªØ§Ø¨">

        <label>ğŸ“˜ Ø§Ø³Ù… Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</label>
        <input type="text" id="col_homework" value="Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª">

        <label>ğŸ¤ Ø§Ø³Ù… Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</label>
        <input type="text" id="col_participation" value="Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©">

        <label>â³ Ø§Ø³Ù… Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙØªØ±Ø©</label>
        <input type="text" id="col_period" value="ÙØªØ±Ø©">

        <hr>
        <label>ğŸ”¤ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ´Ù (px)</label>
        <input type="number" id="print_font_size" value="10" min="8" max="16">

        <label>â†• Ø§Ø±ØªÙØ§Ø¹ ØµÙ Ø§Ù„Ø·Ø§Ù„Ø¨ (px)</label>
        <input type="number" id="row_height" value="13" min="10" max="25">

        <label>â¬œ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª ÙÙŠ ÙƒÙ„ Ø¹Ù…ÙˆØ¯</label>
        <input type="number" id="box_count" value="10" min="5" max="20">

        <hr>
        <label>ğŸ“„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø¹Ù„ÙˆÙŠ (mm)</label>
        <input type="number" id="margin_top" value="2">

        <label>ğŸ“„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø³ÙÙ„ÙŠ (mm)</label>
        <input type="number" id="margin_bottom" value="2">

        <label>ğŸ“„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø£ÙŠÙ…Ù† (mm)</label>
        <input type="number" id="margin_right" value="6">

        <label>ğŸ“„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø£ÙŠØ³Ø± (mm)</label>
        <input type="number" id="margin_left" value="6">

        <div class="grid-fit" style="margin-top:6px">
          <button class="btn" onclick="savePrintSettings()" style="background:var(--ok);color:#fff">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          <button class="btn" onclick="resetPrintSettings()">ğŸ” Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Ø®Ù„ÙÙŠØ© Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="settingsOverlay" style="position:fixed;inset:0;background:rgba(0,0,0,.15);display:none;z-index:999" onclick="closeSettings()"></div>

<script>
// ===== Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø°ÙƒÙŠ =====
function isRunningAsPWA() {
    return window.navigator.standalone || 
           window.matchMedia('(display-mode: standalone)').matches;
}

function checkAndShowHomeButton() {
    const homeButton = document.getElementById('pwa-home-button');
    if (!homeButton) return;
    
    if (isRunningAsPWA()) {
        const isHomePage = window.location.pathname === '/' || 
                          window.location.pathname.endsWith('index.html') ||
                          (window.location.search === '' && window.location.hash === '');
        
        if (isHomePage) {
            homeButton.classList.remove('visible');
        } else {
            homeButton.classList.add('visible');
        }
    } else {
        homeButton.classList.remove('visible');
    }
}

function goToHomePage() {
    window.location.href = window.location.origin + window.location.pathname;
}

// Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØµÙØ­Ø©
setInterval(checkAndShowHomeButton, 1000);

// ===== Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø§Ø¨ (Ù…Ø®ØªØµØ± Ù„Ù„ØªÙˆØ¶ÙŠØ­) =====
const LS_KEY = 'students_db';
let students = [];

function loadStudents() {
    try {
        const data = localStorage.getItem(LS_KEY);
        students = data ? JSON.parse(data) : [];
        renderTable();
    } catch (e) {
        students = [];
    }
}

function saveStudents() {
    localStorage.setItem(LS_KEY, JSON.stringify(students));
    renderTable();
}

function renderTable() {
    const tbody = document.getElementById('tbody');
    if (!tbody) return;
    
    tbody.innerHTML = students.map((student, index) => `
        <tr>
            <td><input type="checkbox" class="rowSel"></td>
            <td>${escapeHtml(student.name || '')}</td>
            <td>${escapeHtml(student.phone || '')}</td>
            <td>${escapeHtml(student.id || '')}</td>
            <td>${escapeHtml(student.grade || '')}</td>
            <td>${escapeHtml(student.class || '')}</td>
            <td>
                <button class="btn" onclick="editStudent(${index})">âœï¸</button>
                <button class="btn" onclick="deleteStudent(${index})" style="background:#fee2e2;color:#dc2626;">ğŸ—‘ï¸</button>
            </td>
        </tr>
    `).join('');
    
    document.getElementById('countTotal').textContent = students.length;
    document.getElementById('countFiltered').textContent = students.length;
}

function escapeHtml(text) {
    return String(text || '').replace(/[&<>"']/g, 
        char => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[char]));
}

function addStudent() {
    const student = {
        name: document.getElementById('f_name').value.trim(),
        phone: document.getElementById('f_phone').value.trim(),
        id: document.getElementById('f_id').value.trim(),
        grade: document.getElementById('f_grade').value.trim(),
        class: document.getElementById('f_class').value.trim()
    };
    
    if (!student.name) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
        return;
    }
    
    students.unshift(student);
    saveStudents();
    clearForm();
}

function editStudent(index) {
    const student = students[index];
    document.getElementById('f_name').value = student.name || '';
    document.getElementById('f_phone').value = student.phone || '';
    document.getElementById('f_id').value = student.id || '';
    document.getElementById('f_grade').value = student.grade || '';
    document.getElementById('f_class').value = student.class || '';
    
    document.getElementById('addFormCard').classList.remove('hidden');
    document.getElementById('addFormCard').scrollIntoView({behavior: 'smooth'});
}

function deleteStudent(index) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) {
        students.splice(index, 1);
        saveStudents();
    }
}

function clearForm() {
    document.getElementById('f_name').value = '';
    document.getElementById('f_phone').value = '';
    document.getElementById('f_id').value = '';
    document.getElementById('f_grade').value = '';
    document.getElementById('f_class').value = '';
}

// ===== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© =====
document.addEventListener('DOMContentLoaded', function() {
    loadStudents();
    checkAndShowHomeButton();
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    document.getElementById('saveBtn').addEventListener('click', addStudent);
    document.getElementById('toggleAddFormBtn').addEventListener('click', function() {
        document.getElementById('addFormCard').classList.toggle('hidden');
    });
    
    document.getElementById('searchBox').addEventListener('input', function() {
        renderTable();
    });
});

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù…Ø¨Ø³Ø·Ø©) =====
function openSettings() {
    document.getElementById('settingsPanel').classList.add('open');
    document.getElementById('settingsOverlay').style.display = 'block';
}

function closeSettings() {
    document.getElementById('settingsPanel').classList.remove('open');
    document.getElementById('settingsOverlay').style.display = 'none';
}

function toggleAcc(id) {
    document.getElementById(id).classList.toggle('open');
}

function savePrintSettings() {
    alert('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©');
}

function resetPrintSettings() {
    alert('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
}

function printFilteredGradeReport() {
    alert('Ø¬Ø§Ø±ÙŠ Ø·Ø¨Ø§Ø¹Ø© ÙƒØ´Ù Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©...');
}
</script>
</body>
</html>
